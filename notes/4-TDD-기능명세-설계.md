# TDD, 기능 명세, 설계

## 기능 명세 구체화

테스트 코드를 작성하려면 파라미터와 결과 값을 정해야 하므로 개발자는 요구사항 문서에서 입력과 결과를 도출해야 한다.

예를 들어 요구사항이 아래와 같았을 때,

- 서비스를 사용하려면 매달 1만원을 선불로 납부한다. 납부일 기준으로 한달 뒤가 서비스 만료일이 된다.
- 2개월 이상 요금을 납부할 수 있다.
- 10만원을 납부하면 서비스를 1년 제공한다.

테스트를 작성할 때는 한달 뒤에 대한 정확한 예가 필요하다.

예를 들어 1월 31일에 납부하면 한달 뒤가 정확히 언제인지에 대한 예가 필요하다.

- 납부일이 4월 1일인 경우, 5월 1일이 만료일이다.
- 납부일이 1월 31일인 경우, 2월 28일이 만료일이다. (윤년인 경우 2월 29일이 만료일이다.)
- 1월 29일이나 1월 30일에 만원을 납부해도 2월 28일이다. (윤년인 경우 29일)
- 1월 31일이나 5월 31일처럼 만원을 납부한 일자가 다음 달 말일 날자보다 크면 만료일은 다음 달 말일이다.

이렇게 구체적인 내용을 알게되면 테스트를 아래와 같이 작성할 수 있다.

```java
@Test
void 납부일과_한달_뒤_일자가_같지_않음() {
    assertExpiryDate(LocalDate.of(2022, 1, 31), 10_000, LocalDate.of(2022, 2, 28));
    assertExpiryDate(LocalDate.of(2022, 5, 31), 10_000, LocalDate.of(2022, 6, 30));
    assertExpiryDate(LocalDate.of(2024, 1, 31), 10_000, LocalDate.of(2024, 2, 29));
}
```

테스트 사례를 추가하면서 다음과 같이 첫 납부일에 따라 만료일이 다른 상황을 구체화할 수 있다.

```java
void 첫_납부일과_만료일_일자가_다를때_이만원_이상_납부() {
    assertExpiryDate(
        PaymentData.builder()
            .firstBillingDate(LocalDate.of(2022, 1, 31))
            .datePaid(LocalDate.of(2022, 2, 28))
            .paidAmount(20_000)
            .build(),
        LocalDate.of(2022, 4, 30)
    );
}
```

최초 납부일에 따라 만료일이 정해지는 케이스에 대한 처리 예시다.

테스트 코드는 예를 이용한 구체적인 명세가 되기 때문에 가능한 구체적인 예를 들어 모호함을 없애야 한다.

처음 접하는 게임을 할 때 규칙을 들어도 완벽하게 이해는 되지 않는다.

실제로 게임을 하면서 다양한 상황에 규칙이 적용되는 것을 보면서 점차 이해하게 되는데, 이는 TDD와 유사하다.

구체적인 예를 이용해서 테스트 코드를 추가하다 보면 기능 명세를 보다 잘 이해하고 모호함을 없앨 수 있다.

테스트 코드는 바로 실행할 수 있고, 구체적인 예를 이용해서 기능을 바로 실행해 볼 수 있다.

특정 상황에서 코드가 어떻게 동작하는지 이해하고 싶다면 해당 상황을 검증하는 테스트를 실행하고 이해가 필요한 코드를 추적하면 된다.

최대한 예외적인 상황이나 복잡한 상황에 해당하는 구체적인 예를 끄집어내어 올바르게 원하는 결과물을 개발해보자.